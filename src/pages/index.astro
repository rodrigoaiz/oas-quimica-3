---
import Base from '@/layouts/Base.astro';
import HeroQuimico from '@/components/HeroQuimico.astro';
import BentoGrid from '@/components/BentoGrid.jsx';
import { getCollection } from 'astro:content';

// Obtener todas las entradas de objetos
const allObjetos = await getCollection('objetos');

// Separar los OAs principales de las pantallas
// OAs principales: oa1.mdx, oa2.mdx, oa3.mdx (sin "/" en el ID)
// Pantallas: oa1/introduccion.mdx, oa1/dalton.mdx, etc. (con "/" en el ID)
const oasPrincipales = allObjetos.filter(obj => !obj.id.includes('/'));
const pantallas = allObjetos.filter(obj => obj.id.includes('/'));

// Crear un mapa de objetos para obtener t√≠tulos
const objetosMap: Record<string, string> = {};
oasPrincipales.forEach(obj => {
  const slug = obj.id.replace('.mdx', ''); // "oa1.mdx" -> "oa1"
  objetosMap[slug] = obj.data.title;
});

// Preparar las pantallas para el BentoGrid
// Filtrar solo las que tengan oaSlug y screenSlug definidos
const screens = pantallas
  .filter(screen => screen.data.oaSlug && screen.data.screenSlug)
  .map(screen => ({
    oaSlug: screen.data.oaSlug!,
    oaTitle: objetosMap[screen.data.oaSlug!] || screen.data.oaSlug!,
    screenSlug: screen.data.screenSlug!,
    screenTitle: screen.data.title,
    order: screen.data.order
  }));

console.log('ObjetosMap:', objetosMap);
console.log('Pantallas count:', pantallas.length);
console.log('Screens preparadas:', screens.slice(0, 3));
---
<Base title="Qu√≠mica 3 ¬∑ CCH ‚Äì Objetos de aprendizaje">
  <HeroQuimico />
  <main id="contenido" class="mx-auto max-w-screen-lg px-4 py-10">
    <section id="objetos" aria-labelledby="objs">
      <div class="flex items-center justify-between mb-6">
        <h2 id="objs" class="text-2xl font-bold">Explora los contenidos</h2>
        <a 
          href="/objetos/" 
          class="text-sm font-medium text-cch-azul hover:underline flex items-center gap-1"
        >
          Ver todos
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" />
          </svg>
        </a>
      </div>
      
      <p class="text-slate-600 mb-6">
        Selecci√≥n aleatoria de pantallas de los objetos de aprendizaje. Cada vez que recargues la p√°gina ver√°s contenidos diferentes.
      </p>

      <!-- Bento Grid con pantallas aleatorias (React Island) -->
      <BentoGrid screens={screens} client:load />
    </section>

    <section id="como-funciona" class="mt-16 prose max-w-none">
      <h2 class="text-2xl font-bold mb-4">C√≥mo funciona</h2>
      <div class="grid md:grid-cols-2 gap-6 not-prose">
        <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-6">
          <div class="text-3xl mb-3">üì±</div>
          <h3 class="font-bold text-lg mb-2">Mobile-First</h3>
          <p class="text-slate-700">
            Dise√±ado para funcionar perfectamente en m√≥vil, tableta o escritorio. Navega desde cualquier dispositivo.
          </p>
        </div>
        
        <div class="bg-purple-50 border-2 border-purple-200 rounded-xl p-6">
          <div class="text-3xl mb-3">üéØ</div>
          <h3 class="font-bold text-lg mb-2">Por pantallas</h3>
          <p class="text-slate-700">
            Cada tema est√° dividido en pantallas cortas. Avanza a tu ritmo usando los botones de navegaci√≥n.
          </p>
        </div>
        
        <div class="bg-green-50 border-2 border-green-200 rounded-xl p-6">
          <div class="text-3xl mb-3">‚ú®</div>
          <h3 class="font-bold text-lg mb-2">Interactivos</h3>
          <p class="text-slate-700">
            Actividades de opci√≥n m√∫ltiple, ejercicios pr√°cticos y autoevaluaciones para reforzar tu aprendizaje.
          </p>
        </div>
        
        <div class="bg-orange-50 border-2 border-orange-200 rounded-xl p-6">
          <div class="text-3xl mb-3">üîñ</div>
          <h3 class="font-bold text-lg mb-2">Acceso directo</h3>
          <p class="text-slate-700">
            Salta directamente a cualquier pantalla desde el √≠ndice. Retoma donde lo dejaste f√°cilmente.
          </p>
        </div>
      </div>
    </section>
  </main>
</Base>

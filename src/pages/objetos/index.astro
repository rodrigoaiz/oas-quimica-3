---
import Base from '@/layouts/Base.astro';
import { getCollection } from 'astro:content';
import Breadcrumb from '@/components/Breadcrumb.astro';

const objetos = (await getCollection('objetos')).sort((a,b)=>a.data.order-b.data.order);

// Mapeo de slugs a primera pantalla (introduccion por defecto)
// En el futuro esto puede venir de configuración
const defaultScreens: Record<string, string> = {
  'oa1': 'introduccion',
  'oa2': 'introduccion',
  'oa3': 'introduccion',
};

const breadcrumbItems = [
  { label: 'Inicio', href: '/' },
  { label: 'Objetos de aprendizaje' }
];
---
<Base title="Objetos de aprendizaje · Química 3">
  <main id="contenido" class="mx-auto max-w-screen-lg px-4 py-10">
    <Breadcrumb items={breadcrumbItems} />
    
    <h1 class="text-3xl font-bold mb-8 text-cch-azul">Objetos de aprendizaje</h1>
    
    <ul class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {objetos.map(({ slug, data }) => {
        const firstScreen = defaultScreens[slug] || 'introduccion';
        const href = `/objetos/${slug}/${firstScreen}`;
        
        return (
          <li class="card bg-white rounded-xl shadow-md hover:shadow-xl transition-shadow overflow-hidden">
            <a href={href} class="block">
              <img src={data.cover} alt="" class="w-full aspect-video object-cover" loading="lazy" />
              <div class="p-4">
                <h3 class="text-lg font-semibold text-slate-900 mb-2">{data.title}</h3>
                <p class="text-sm text-slate-600">{data.level} · {data.duration ?? '15–25 min'}</p>
                {data.summary && (
                  <p class="text-sm text-slate-500 mt-2 line-clamp-2">{data.summary}</p>
                )}
              </div>
            </a>
          </li>
        );
      })}
    </ul>
  </main>
</Base>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
